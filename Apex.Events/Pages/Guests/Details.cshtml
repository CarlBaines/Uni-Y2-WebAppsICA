@page "{id:int}"
@model Apex.Events.Pages.Guests.DetailsModel

@{
    ViewData["Title"] = "Details";
}


<div class="center-container">
    <h1><b>Details - Guest</b></h1>
    <hr />
    <dl class="row">
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.Guest.FirstName)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Guest.FirstName)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.Guest.LastName)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Guest.LastName)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.Guest.Email)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Guest.Email)
        </dd>
    </dl>

    <h5><b>Booked Events</b></h5>
    @if(Model.Guest?.GuestBookings is { Count: > 0 })
    {
        @* This HTML is not rendered if no guest bookings exist. *@
        <form method="post">
            <input type ="hidden" name="guestId" value="@Model.Guest.GuestId" />
            <ul>
                @foreach (var bookedEvent in Model.Guest.GuestBookings)
                {
                    var evt = bookedEvent.Event;
                    <li>
                        @if (evt is not null)
                        {
                            @($"{evt.EventName}: {evt.EventDate}".Trim())
                            <span>@Html.CheckBox("IsAttending_" + bookedEvent.EventId, bookedEvent.IsAttending)</span>
                        }
                        else
                        {
                            @:"Unknown Event"
                        }
                    </li>
                }
            </ul>
            <button type = "submit" class="btn btn-primary">Register Attendance</button>
            <br />
        </form>
    } else
    {
        <p>No Guest Bookings</p>
    }

    <br />
    <h5><b>Registered Attendance for Events</b></h5>
    @if(Model.Guest?.GuestBookings is { Count: > 0 })
    {
        @*Filter to only events with registered attendance.*@
        var attended = Model.Guest.GuestBookings.Where(gb => gb.IsAttending);
        @if (attended.Any())
        {
            <ul>
                @foreach (var eventAttending in attended)
                {
                    var evt = eventAttending.Event;
                    <li>
                        @if (evt is not null)
                        {
                            @($"{evt.EventName}: {evt.EventDate}".Trim())
                        }
                        else
                        {
                            @:"Unknown Event"
                        }
                    </li>
                }
            </ul>
        }
        else
        {
            <p>No Registered Attendance for Events</p>
        }
    }
    else
    {
        <p>No Registered Attendance for Events</p>
    }
    <div>
        <a asp-page="./Edit" asp-route-id="@Model.Guest?.GuestId">Edit</a> |
        <a asp-page="./Index">Back to List</a>
    </div>
</div>

